{"name":"New Macro","permission":{"default":0,"32ZkYvbHiDQLbFjs":3},"type":"chat","sort":100001,"flags":{},"scope":"global","command":"","author":"32ZkYvbHiDQLbFjs","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"1u94PNjXOjIwwIaO"}
{"_id":"2K8nJFOqKWwszZDr","name":"turn_defeated_into_loot","permission":{"default":0,"ODY1ZmU3OWIzNzY2":3},"type":"script","sort":100001,"flags":{"combat-utility-belt":{"macroTrigger":"v2dfsrme7kq8aaf9"},"exportSource":{"world":"lmop-kids","system":"dnd5e","coreVersion":"0.7.9","systemVersion":"1.2.0"}},"scope":"global","command":"(async () => {\n    let defeated = canvas.tokens.placeables.filter(t => {\n        return t.data.disposition === -1 && t.data.actorData.data?.attributes?.hp?.value <= 0\n    });\n\n    for (let token of defeated) {\n        if (token.actor.data.type != 'npc')\n            continue;\n\n        let invalid = await token.getFlag(`world`,`lootyfied`) ? await token.getFlag(`world`,`lootyfied`) : false;\n        if (invalid)\n            continue;\n\n        let newItems = token.actor.data.items.filter(item => {\n            // Weapons are fine, unless they're natural.\n            if (item.type == 'weapon') {\n                return item.data.weaponType != 'natural';\n            }\n            // Equipment's fine, unless it's natural armor.\n            if (item.type == 'equipment') {\n                if (!item.data.armor)\n                    return true;\n                return item.data.armor.type != 'natural';\n            }\n            // Item type blocklist.\n            // Less intuitive than an allowlist,\n            // but permits unknown module items.\n            return !(['class', 'spell', 'feat'].includes(item.type));\n        });\n\n        // Change sheet to lootable, and give players permissions.\n        let newActorData = {\n            'flags': {\n                'core': {\n                    'sheetClass': 'dnd5e.LootSheet5eNPC'\n                },\n                'lootsheetnpc5e': {\n                    'lootsheettype': 'Loot'\n                }\n            },\n            'items': newItems,\n            [`permission.default`]: 2\n        };\n        // Add proper currency info to the new data, if the actor needs it.\n        if (undefined == token.actor.data.data.currency || token.actor.data.data.currency.cp == 0 ) // should be an object, not a number\n        {\n            newActorData['data.currency'] = {\n                'cp': { 'value': null },\n                'ep': { 'value': null },\n                'gp': { 'value': null },\n                'pp': { 'value': null },\n                'sp': { 'value': null }\n            };\n        }\n        await token.actor.update(newActorData);\n        await token.setFlag(`world`,`lootyfied`,true);\n    }\n})();","author":"ODY1ZmU3OWIzNzY2","img":"icons/svg/dice-target.svg","actorIds":[]}
{"name":"Scimitar","permission":{"default":0,"ODY1ZmU3OWIzNzY2":3},"type":"script","sort":100001,"flags":{"dnd5e":{"itemMacro":true}},"scope":"global","command":"game.dnd5e.rollItemMacro(\"Scimitar\");","author":"ODY1ZmU3OWIzNzY2","img":"systems/dnd5e/icons/items/weapons/sword-curved.jpg","actorIds":[],"_id":"BhcsXbjqRvfyRP33"}
{"name":"Handaxe","permission":{"default":0,"rKPIT7hPrfRQcu3z":3},"type":"script","sort":100001,"flags":{"dnd5e":{"itemMacro":true}},"scope":"global","command":"game.dnd5e.rollItemMacro(\"Handaxe\");","author":"rKPIT7hPrfRQcu3z","img":"systems/dnd5e/icons/items/weapons/handaxe.jpg","actorIds":[],"_id":"C9mNkXZxc3y9GPm8"}
{"name":"Javelin","permission":{"default":0,"rKPIT7hPrfRQcu3z":3},"type":"script","sort":100001,"flags":{"dnd5e":{"itemMacro":true}},"scope":"global","command":"game.dnd5e.rollItemMacro(\"Javelin\");","author":"rKPIT7hPrfRQcu3z","img":"systems/dnd5e/icons/items/weapons/bolt.png","actorIds":[],"_id":"EdTn0W2QjriJRxoy"}
{"name":"Dagger","permission":{"default":0,"VnCpnjpqlVQEWgRE":3},"type":"script","sort":100001,"flags":{"dnd5e":{"itemMacro":true}},"scope":"global","command":"game.dnd5e.rollItemMacro(\"Dagger\");","author":"VnCpnjpqlVQEWgRE","img":"systems/dnd5e/icons/items/weapons/dagger.jpg","actorIds":[],"_id":"Hu2spAJiK3Hbpkg7"}
{"_id":"MTU3YWIxNGEwNWY5","name":"Initiative","permission":{"default":2,"ODY1ZmU3OWIzNzY2":3},"type":"chat","sort":0,"flags":{},"scope":"global","command":"Initiative: @{selected|npcd_name}\n/roll 1d20 + @{selected|npcd_dex_mod} &{tracker}","author":"ODY1ZmU3OWIzNzY2","img":"modules/lmop-shared/macros/roll20_macro.png","actorIds":[]}
{"_id":"Scy7Of1fQMxf6Vga","name":"Skeletons Appear","type":"script","author":"ODY1ZmU3OWIzNzY2","img":"icons/svg/dice-target.svg","scope":"global","command":"const update = game.actors.getName(\"Skeleton\").getActiveTokens().map(t => ({_id: t.id, hidden: false}));\ncanvas.scene.updateEmbeddedDocuments(\"Token\", update);","folder":null,"sort":100001,"permission":{"default":0,"ODY1ZmU3OWIzNzY2":3},"flags":{"combat-utility-belt":{"macroTrigger":""}}}
{"name":"Longbow","permission":{"default":0,"32ZkYvbHiDQLbFjs":3},"type":"script","sort":100001,"flags":{"dnd5e":{"itemMacro":true}},"scope":"global","command":"game.dnd5e.rollItemMacro(\"Longbow\");","author":"32ZkYvbHiDQLbFjs","img":"systems/dnd5e/icons/items/weapons/bow-long.jpg","actorIds":[],"_id":"T3YvdjVB2ylMj7UE"}
{"_id":"Z1PVcJrfjEqwC5zZ","name":"Remove Top Bar","permission":{"default":0,"ZjdmMWEyMmE2NzVk":3},"type":"script","folder":null,"sort":100000,"flags":{"combat-utility-belt":{"macroTrigger":""}},"scope":"global","command":"(async ()=>{\r\n   console.log(\"starting\");\r\n   for(let token of canvas.tokens.placeables)\r\n   {\r\n      if (!token.data)\r\n      {\r\n         console.log(\"error: no token.data\");\r\n         continue;\r\n      }\r\n      if (!token.data.name)\r\n      {\r\n         console.log(\"error: no token.data.name\");\r\n         continue;\r\n      }\r\n      console.log(\"token = \" + token.data.name);\r\n      await token.update({ 'bar2.attribute' : 'None' });\r\n      await token.update({ 'bar1.attribute' : 'attributes.hp' });\r\n   }\r\n   console.log(\"ending\");\r\n})();\r\n\r\n","author":"ZjdmMWEyMmE2NzVk","img":"icons/svg/dice-target.svg","actorIds":[]}
{"_id":"Zkyhd4OHoorlpqks","name":"Redbrand Trapped Hallway","type":"script","author":"ODY1ZmU3OWIzNzY2","img":"icons/svg/dice-target.svg","scope":"global","command":"game.togglePause(true, true)\nlet tile = canvas.scene.data.tiles.get(\"ZTE0NDkyNjlmYWQ1\")\ntile.update({\"hidden\" : false})","folder":null,"sort":100001,"permission":{"default":0,"ODY1ZmU3OWIzNzY2":3},"flags":{"combat-utility-belt":{"macroTrigger":""}}}
{"name":"Warhammer","permission":{"default":0,"VnCpnjpqlVQEWgRE":3},"type":"script","sort":100001,"flags":{"dnd5e":{"itemMacro":true}},"scope":"global","command":"game.dnd5e.rollItemMacro(\"Warhammer\");","author":"VnCpnjpqlVQEWgRE","img":"systems/dnd5e/icons/items/weapons/warhammer.png","actorIds":[],"_id":"ZnRmnY9yJTMXkoS4"}
{"name":"Greatsword","permission":{"default":0,"rKPIT7hPrfRQcu3z":3},"type":"script","sort":100001,"flags":{"dnd5e":{"itemMacro":true}},"scope":"global","command":"game.dnd5e.rollItemMacro(\"Greatsword\");","author":"rKPIT7hPrfRQcu3z","img":"systems/dnd5e/icons/items/weapons/sword-great.jpg","actorIds":[],"_id":"xlpiwVxfHAw64kwf"}
{"name":"Greatsword","permission":{"default":0,"32ZkYvbHiDQLbFjs":3},"type":"script","sort":100001,"flags":{"dnd5e":{"itemMacro":true}},"scope":"global","command":"game.dnd5e.rollItemMacro(\"Greatsword\");","author":"32ZkYvbHiDQLbFjs","img":"systems/dnd5e/icons/items/weapons/sword-great.jpg","actorIds":[],"_id":"yfksX1DLqsL6MpDO"}
{"name":"Shield","permission":{"default":0,"VnCpnjpqlVQEWgRE":3},"type":"script","sort":100001,"flags":{"dnd5e":{"itemMacro":true}},"scope":"global","command":"game.dnd5e.rollItemMacro(\"Shield\");","author":"VnCpnjpqlVQEWgRE","img":"systems/dnd5e/icons/items/armor/shield.png","actorIds":[],"_id":"yu19O4ybtWXycUY6"}
